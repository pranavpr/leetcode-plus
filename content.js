// original list here https://github.com/xizhengszhang/Leetcode_company_frequency

console.log('Content script running') // show that script is running

let bgColors = {
    Facebook: "#4267B2",
    Amazon: "#FF9900",
    LinkedIn: "#2867B2",
    Uber: "#000000",
    Microsoft: "#00A4EF",
    Google: "#4285F4"
}

let companyIcons = {
    Facebook: "facebook",
    Amazon: "amazon",
    LinkedIn: "linkedin",
    Uber: "cab",
    Microsoft: "windows",
    Google: "google"
}

let companyDict = {
    Facebook: [ 301, 953, 273, 67, 560, 238, 297, 973, 680, 426, 253, 621, 282, 125, 124, 158, 523, 269, 173, 278, 76, 211, 23, 438, 98, 199, 785, 986, 56, 31, 215, 340, 721, 543, 317, 689, 133, 349, 34, 65, 304, 896, 314, 71, 157, 415, 636, 88, 161, 162, 958, 143, 15, 1249, 33, 987, 1, 139, 146, 270, 311, 708, 350, 29, 114, 825, 824, 236, 1027, 416, 489, 43, 863, 42, 567, 1004, 528, 767, 10, 50, 32, 20, 885, 286, 463, 921, 247, 246, 257, 468, 227, 477, 536, 935, 347, 632, 670, 200, 319, 79, 394, 494, 691, 398, 126, 91, 674, 647, 480, 405, 277, 622, 78, 380, 138, 75, 498, 121, 13, 283, 348, 329, 51, 22, 128, 432, 109, 564, 224, 3, 843, 977, 678, 325, 1060, 8, 339, 46, 1197, 449, 140, 336, 1216, 37, 37, 865, 207, 381, 239, 105, 111, 540, 1094, 358, 963, 341, 163, 419, 1008, 938, 5, 791, 1123, 266, 637, 428, 408, 387, 568, 614, 529, 17, 490, 1053, 166, 53, 2, 151, 249, 692, 295, 1146, 766, 81, 334, 212, 694, 794, 378, 848, 452, 21, 252, 153, 44, 969, 308, 102, 285, 49, 298, 742, 92, 214, 549, 393, 312, 24, 25, 127, 208, 496, 417, 218, 209, 353, 129, 593, 939, 73, 228, 116, 26, 752, 332, 240, 399, 597, 4, 642, 714, 703, 414, 230, 1032, 505, 242, 39, 241, 54, 862, 223, 516, 112, 435, 364, 324, 724, 36, 189, 443, 772, 515, 788, 206, 235, 57, 981, 148, 388, 11, 430, 300, 93, 872, 28, 202, 1091, 94, 113, 68, 188, 450, 145, 103, 344, 159, 137, 122, 628, 41, 104, 66, 1108, 442, 303, 110, 1021, 136, 503, 160, 181, 59, 844, 48, 117, 701, 445, 572, 40, 437, 739, 9, 328, 222, 45, 47, 63, 74, 19, 38, 14, 7, 70, 12, 118, 69, 100, 771 ],
    Amazon: [1,146,200,937,973,5,138,1192,819,20,42,23,2,297,127,295,21,103,48,763,273,236,121,126,17,140,3,675,165,572,4,155,239,212,139,240,269,957,238,12,588,33,253,347,15,348,56,206,642,49,53,45,79,76,387,438,472,54,98,124,11,460,207,380,215,235,341,105,314,102,13,909,116,208,505,117,218,545,149,210,25,322,50,84,490,277,93,695,692,733,994,362,224,22,281,234,8,289,711,449,62,133,78,1000,101,160,694,55,863,284,417,384,543,72,535,167,99,682,134,153,91,151,88,74,228,445,173,141,31,150,199,122,631,64,653,221,96,252,32,10,123,317,227,71,983,70,703,285,143,270,59,261,135,120,179,336,560,57,323,169,373,185,340,895,152,394,24,232,268,866,315,759,113,346,353,652,46,39,538,106,300,75,36,787,68,529,136,28,188,97,73,772,678,286,92,333,503,516,564],
    LinkedIn: [364,244,432,272,716,366,605,170,150,243,256,156,254,339,373,76,671,265,235,53,636,72,297,698,152,611,273,149,57,65,277,730,50,68,380,715,464,261,655,200,127,205,516,215,236,1028,47,744,56,33,367,706,1117,126,46,460,1148,341,528,69,449,104,739,187,1,20,34,61,362,88,349,721,987,12,8,412,102,785,39,40,113,173,142,146,13,54,350,103,973,198,125,141,23],
    Uber: [427,529,332,741,668,773,986,291,227,267,465,655,528,166,365,567,977,253,855,224,36,301,317,837,361,34,863,772,221,56,32,340,297,780,76,486,740,146,305,128,759,359,210,262,49,207,671,20,658,200,341,68,286,218,140,118,1091,3,4,791,127,212,149,295,399,79,449,173,347,239,162,1,346,85,380,131,518,706,17,10,348,42,130,121,31,230,547,269,279,560,62,91,739,40,198,122,45,23,101,692,54,152,55,2,24,5,973,22,139,283,344,70,26,21],
    Microsoft: [146,151,103,138,165,1,54,42,445,5,348,428,88,200,794,253,53,443,22,402,557,186,297,236,240,206,33,2,105,805,285,23,273,44,535,21,218,10,98,8,25,79,75,3,679,232,36,93,20,470,224,155,121,706,688,269,17,48,295,72,114,234,322,347,37,239,68,13,935,362,612,238,225,143,450,15,4,39,431,407,134,636,528,46,73,30,277,449,1185,836,328,31,94,333,51,99,125,43,419,74,102,346,24,153,516,117,227,917,863,560,210,204,286,92,354,116,41,768,287,160,139,49,344,317,127,242,123,289,642,110,979,150,141,969,632,56,162,729,722,545,76,417,529,676,958,168,572,235,510,189,71,83,493,397,212,300,208,173,142,784,721,724,378,416,540,316,171,61,406,158,692,380,26,28,78,97,229,694,611,383,647,622,283,490,575,1239,739,40,426,135,85,415,670,215,468,268,518,214,384,63],
    Google: [ 1007,929,975,904,947,410,843,482,1,222,844,399,753,489,777,809,939,1057,527,158,308,913,299,837,253,642,833,731,359,315,1055,727,679,465,1170,163,943,247,552,818,900,1096,205,246,394,774,770,271,616,524,736,1011,659,963,329,849,1088,951,363,846,801,56,981,288,857,743,788,681,734,354,4,200,1153,42,803,248,1110,767,2,57,528,1066,702,353,471,1032,562,729,686,708,685,317,855,722,346,640,853,457,591,34,208,497,660,380,850,124,551,737,430,221,304,792,772,135,360,911,852,31,146,889,68,1087,76,159,157,941,688,298,334,280,340,3,85,742,23,1231,973,210,710,132,55,683,484,982,1168,766,218,723,979,475,1145,379,835,332,53,1074,776,150,187,433,894,1219,684,444,43,149,799,295,284,285,351,398,817,302,920,310,375,239,726,155,632,771,739,44,358,386,773,224,212,480,1146,87,241,568,895,173,250,558,924,1056,366 ]
};

chrome.runtime.onMessage.addListener(handleMessage); // receive message from background to run handleMessage

function handleMessage(request, sender, sendResponse){
    console.log("LeetCode Plus is " + (request.status === "Off" ? "On" : "Off"));
    if (request.status === "Off") { // if message says to run content script
        let tbody = document.getElementsByClassName('reactable-data');
        let trs = tbody[0].getElementsByTagName("tr");
        document.getElementsByClassName("reactable-th-frequency reactable-header-sortable")[0].innerHTML = '<strong>Company &nbsp;<span id="frequency-tooltip" class="fa fa-question-circle" data-toggle="tooltip" data-placement="top" title="" data-original-title="Only premium members can see the frequency"></span></strong>';
        for (tr of trs) {
            if (tr.textContent !== "") { // need because some tr's are spaces
                tr.getElementsByTagName('td')[6].textContent = "";
                let questionNumber = parseInt(tr.textContent.match(/[a-zA-Z]+|[0-9]+/g)[0]); // gets only the number of the q
                for (var key in companyDict) { // for each company in the dictionary
                    if (companyDict[key].includes(questionNumber)){ // if the question number is in the company
                        tr.getElementsByTagName('td')[6].innerHTML += '<span class="label round" style="background-color: '+ bgColors[key] +';"><i class="fa fa-'+ companyIcons[key]+'" aria-hidden="true"></i></span> ';
                    }
                }
            }
        }
        chrome.runtime.sendMessage({"status": "On"});
    }
    else {
        // revert styles back
        let tbody = document.getElementsByClassName('reactable-data');
        let trs = tbody[0].getElementsByTagName("tr");
        document.getElementsByClassName("reactable-th-frequency reactable-header-sortable")[0].innerHTML = '<strong>Frequency &nbsp;<span id="frequency-tooltip" class="fa fa-question-circle" data-toggle="tooltip" data-placement="top" title="" data-original-title="Only premium members can see the frequency"></span></strong>';
        for (tr of trs) {
            if (tr.textContent !== "") { // need because some tr's are spaces
                let questionNumber = parseInt(tr.textContent.match(/[a-zA-Z]+|[0-9]+/g)[0]); // gets only the number of the q
                tr.getElementsByTagName('td')[6].innerHTML = '<div class="frequency-locked"><span><span class="" data-toggle="tooltip" data-placement="top" data-original-title="Frequency of problems that appear in real interviews" aria-hidden="true" style="cursor: pointer;"><i class="fa fa-lock"></i></span></span></div>';
            }
        }

        chrome.runtime.sendMessage({"status": "Off"});
    }
}
